
> enhanced-ado-mcp-server@2.1.0 pretest
> npm run generate-openapi


> enhanced-ado-mcp-server@2.1.0 generate-openapi
> tsx scripts/generate-openapi.ts

â‰¡Æ’ÃœÃ‡ Generating OpenAPI specification...

â‰¡Æ’Ã´Ã¼ Creating output directory: C:\Users\ameliapayne\ADO-Work-Item-MSP\docs\api
â‰¡Æ’Ã´Â¥ Generating OpenAPI 3.0 specification...
Î“Â£Ã´ Generated OpenAPI spec: C:\Users\ameliapayne\ADO-Work-Item-MSP\docs\api\openapi.json

â‰¡Æ’Ã´Âª Generating individual JSON schemas...
Î“Â£Ã´ Generated schema: create-workitem.json
Î“Â£Ã´ Generated schema: assign-copilot.json
Î“Â£Ã´ Generated schema: get-context.json
Î“Â£Ã´ Generated schema: extract-security-links.json
Î“Â£Ã´ Generated schema: query-wiql.json
Î“Â£Ã´ Generated schema: query-odata.json
Î“Â£Ã´ Generated schema: execute-bulk-operations.json
Î“Â£Ã´ Generated schema: link-workitems.json
Î“Â£Ã´ Generated schema: undo-bulk.json
Î“Â£Ã´ Generated schema: undo-forensic.json
Î“Â£Ã´ Generated schema: export-work-items.json
Î“Â£Ã´ Generated schema: analyze-workload.json
Î“Â£Ã´ Generated schema: discover-tools.json
Î“Â£Ã´ Generated schema: analyze-query-handle.json
Î“Â£Ã´ Generated schema: analyze-bulk.json
Î“Â£Ã´ Generated schema: list-handles.json
Î“Â£Ã´ Generated schema: inspect-handle.json
Î“Â£Ã´ Generated schema: get-context-bulk.json
Î“Â£Ã´ Generated schema: get-config.json
Î“Â£Ã´ Generated schema: get-team-members.json
Î“Â£Ã´ Generated schema: get-prompts.json
Î“Â£Ã´ Generated schema: list-agents.json
Î“Â£Ã´ Generated schema: discover-custom-fields.json
Î“Â£Ã´ Generated schema: export-field-schema.json
Î“Â£Ã´ Generated schema: get-pr-diff.json
Î“Â£Ã´ Generated schema: get-pr-comments.json
Î“Â£Ã´ Generated schema: add-pr-comment.json
Î“Â£Ã´ Generated schema index: index.json (27 schemas)

Î“Â£Ã  OpenAPI generation complete!

Generated files:
  - docs/api/openapi.json (27 endpoints)
  - docs/api/schemas/*.json (27 schemas)

Output directory: C:\Users\ameliapayne\ADO-Work-Item-MSP\docs\api

You can now use these files to:
  - Generate API clients
  - Create API documentation
  - Validate requests/responses
  - Import into tools like Swagger UI, Postman, etc.

> enhanced-ado-mcp-server@2.1.0 test
> jest hybridTransport.test.ts

  console.error
    [2025-12-06T01:31:29.832Z] [INFO] Query Handle Service initialized at 2025-12-06T01:31:29.832Z

    [0m [90m 125 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39mmcpConnected) {
     [90m 126 |[39m       [36mconst[39m contextStr [33m=[39m context [33m?[39m [32m` ${JSON.stringify(context)}`[39m [33m:[39m [32m''[39m[33m;[39m
    [31m[1m>[22m[39m[90m 127 |[39m       console[33m.[39merror([32m`[${timestamp}] [INFO] ${message}${contextStr}`[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 128 |[39m     }
     [90m 129 |[39m     
     [90m 130 |[39m     [90m// Always write to file if configured[39m[0m

      at Logger.info (src/utils/logger.ts:127:15)
      at new QueryHandleService (src/services/query-handle-service.ts:120:12)
      at Object.<anonymous> (src/services/query-handle-service.ts:835:35)
      at test/setup.ts:49:36
      at Object.<anonymous> (test/setup.ts:49:36)

  console.error
    [2025-12-06T01:31:29.862Z] [INFO] Query handle expiration: 1440 minutes (max: 2880 minutes)

    [0m [90m 125 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39mmcpConnected) {
     [90m 126 |[39m       [36mconst[39m contextStr [33m=[39m context [33m?[39m [32m` ${JSON.stringify(context)}`[39m [33m:[39m [32m''[39m[33m;[39m
    [31m[1m>[22m[39m[90m 127 |[39m       console[33m.[39merror([32m`[${timestamp}] [INFO] ${message}${contextStr}`[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 128 |[39m     }
     [90m 129 |[39m     
     [90m 130 |[39m     [90m// Always write to file if configured[39m[0m

      at Logger.info (src/utils/logger.ts:127:15)
      at new QueryHandleService (src/services/query-handle-service.ts:121:12)
      at Object.<anonymous> (src/services/query-handle-service.ts:835:35)
      at test/setup.ts:49:36
      at Object.<anonymous> (test/setup.ts:49:36)

  console.error
    [2025-12-06T01:31:29.867Z] [INFO] [Telemetry] Shutdown complete

    [0m [90m 125 |[39m     [36mif[39m ([33m![39m[36mthis[39m[33m.[39mmcpConnected) {
     [90m 126 |[39m       [36mconst[39m contextStr [33m=[39m context [33m?[39m [32m` ${JSON.stringify(context)}`[39m [33m:[39m [32m''[39m[33m;[39m
    [31m[1m>[22m[39m[90m 127 |[39m       console[33m.[39merror([32m`[${timestamp}] [INFO] ${message}${contextStr}`[39m)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 128 |[39m     }
     [90m 129 |[39m     
     [90m 130 |[39m     [90m// Always write to file if configured[39m[0m

      at Logger.info (src/utils/logger.ts:127:15)
      at TelemetryService.shutdown (src/services/telemetry-service.ts:639:12)
      at Object.<anonymous> (test/setup.ts:64:28)

FAIL test/unit/hybridTransport.test.ts (33.597 s)
  HybridStdioServerTransport
    Transport Initialization
      Î“ÃªÃœ should create transport with default streams (3 ms)
      Î“ÃªÃœ should create transport with custom streams (1 ms)
      Î“ÃªÃœ should start successfully
      Î“ÃªÃœ should throw error when starting already started transport (15 ms)
      Î“ÃªÃœ should close successfully (1 ms)
      Î“ÃªÃœ should trigger onclose callback when closed (1 ms)
    Message Sending
      Î“ÃªÃœ should send message with Content-Length framing by default (2 ms)
      Î“ÃªÃœ should send message with newline framing when MCP_FORCE_NEWLINE=1 (1 ms)
      Î“ÃªÃœ should send message with Content-Length framing when MCP_FORCE_CONTENT_LENGTH=1 (1 ms)
      Î“ÃªÃœ should calculate correct Content-Length for UTF-8 strings
      Î“ÃªÃœ should handle backpressure with drain event (2 ms)
    Message Receiving - Content-Length Framing
      Î“ÃªÃœ should receive complete Content-Length framed message (1 ms)
      Î“ÃªÃœ should handle message arriving in multiple chunks (13 ms)
      Î“ÃªÃœ should handle multiple messages in one chunk (66 ms)
      Î“ÃªÃœ should handle UTF-8 characters in Content-Length framed messages (1 ms)
      Î“ÃªÃœ should wait for complete message body before parsing (62 ms)
    Message Receiving - Newline Framing
      Î“ÃªÃœ should receive newline-delimited JSON message (1 ms)
      Î“ÃªÃœ should handle multiple newline-delimited messages (61 ms)
      Î“ÃªÃœ should ignore empty lines in newline-delimited mode (63 ms)
      Î“ÃªÃœ should handle CRLF line endings in newline mode
    Error Handling
      â”œÃ¹ should trigger onerror callback for invalid JSON in message body (30014 ms)
      Î“ÃªÃœ should trigger onerror callback for invalid newline-delimited JSON (2 ms)
      Î“ÃªÃœ should handle stdin error events (1 ms)
      Î“ÃªÃœ should skip malformed Content-Length header and continue (53 ms)
      â”œÃ¹ should not crash on data processing errors (93 ms)
    Connection Lifecycle
      â”œÃ¹ should handle start -> send -> receive -> close lifecycle (62 ms)
      Î“ÃªÃœ should not accept messages after close (61 ms)
    Buffer Management
      Î“ÃªÃœ should handle large messages without buffer issues (1 ms)
      Î“ÃªÃœ should correctly accumulate partial messages in buffer (236 ms)
    Auto-Detection of Framing Mode
      Î“ÃªÃœ should detect Content-Length framing when header present (2 ms)
      Î“ÃªÃœ should detect newline framing when message starts with brace
      Î“ÃªÃœ should handle mixed framing modes in sequence (122 ms)

  Î“Ã¹Ã… HybridStdioServerTransport Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should trigger onerror callback for invalid JSON in message body

    thrown: "Exceeded timeout of 30000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      366 |     });
      367 |     
    > 368 |     it('should trigger onerror callback for invalid JSON in message body', (done) => {
          |       ^
      369 |       const invalidJson = 'Content-Length: 10\r\n\r\n{invalid}';
      370 |       
      371 |       transport.onerror = (err) => {

      at test/unit/hybridTransport.test.ts:368:7
      at test/unit/hybridTransport.test.ts:363:11
      at Object.<anonymous> (test/unit/hybridTransport.test.ts:14:9)

  Î“Ã¹Ã… HybridStdioServerTransport Î“Ã‡â•‘ Error Handling Î“Ã‡â•‘ should not crash on data processing errors

    expect(received).toBeGreaterThanOrEqual(expected)

    Expected: >= 1
    Received:    0

      447 |       await new Promise(resolve => setTimeout(resolve, 50));
      448 |       // Should have received the valid message despite earlier errors
    > 449 |       expect(messages.length).toBeGreaterThanOrEqual(1);
          |                               ^
      450 |     });
      451 |   });
      452 |   

      at Object.<anonymous> (test/unit/hybridTransport.test.ts:449:31)

  Î“Ã¹Ã… HybridStdioServerTransport Î“Ã‡â•‘ Connection Lifecycle Î“Ã‡â•‘ should handle start -> send -> receive -> close lifecycle

    expect(received).toContain(expected) // indexOf

    Expected value: {"id": 1, "jsonrpc": "2.0", "result": {"initialized": true}}
    Received array: [{"id": 1, "jsonrpc": "2.0", "result": {"initialized": true}}]

    Looks like you wanted to test for object/array equality with the stricter `toContain` matcher. You probably need to use `toContainEqual` instead.

      500 |       // Verify lifecycle
      501 |       expect(sentMessages.length).toBeGreaterThan(0);
    > 502 |       expect(receivedMessages).toContain(incomingMessage);
          |                                ^
      503 |       expect(closeCalled).toBe(true);
      504 |     });
      505 |     

      at Object.<anonymous> (test/unit/hybridTransport.test.ts:502:32)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 29 passed, 32 total
Snapshots:   0 total
Time:        33.955 s, estimated 38 s
Ran all test suites matching /hybridTransport.test.ts/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
